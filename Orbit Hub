-- Full Orbit Hub Script
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local Camera = workspace.CurrentCamera

-- GUI Setup
local gui = Instance.new("ScreenGui", game.CoreGui)
gui.Name = "OrbitHub"

local openButton = Instance.new("TextButton")
openButton.Name = "OpenButton"
openButton.AnchorPoint = Vector2.new(0.5, 0.5)
openButton.Position = UDim2.new(0.5, 0, 0.5, 0)
openButton.Size = UDim2.new(0, 50, 0, 50)
openButton.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
openButton.Text = ""
openButton.AutoButtonColor = false
openButton.Parent = gui
Instance.new("UICorner", openButton).CornerRadius = UDim.new(1, 0)

local mainFrame = Instance.new("Frame")
mainFrame.Name = "MainFrame"
mainFrame.AnchorPoint = Vector2.new(0.5, 0.5)
mainFrame.Position = UDim2.new(0.5, 0, 0.5, 0)
mainFrame.Size = UDim2.new(0, 300, 0, 400)
mainFrame.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
mainFrame.Visible = false
mainFrame.Parent = gui
Instance.new("UICorner", mainFrame).CornerRadius = UDim.new(0, 8)

-- ... [ADD ALL THE GUI CODE FROM PREVIOUS VERSION HERE] ...

-- Core Variables
local silentAimEnabled = false
local ESPEnabled = false
local SilentAimSettings = {
    TargetPart = "Head",
    FOV = 200,
    TeamCheck = true,
    HitChance = 100,
    BodyHit = false
}

-- ... [ADD ALL THE FUNCTIONALITY CODE FROM PREVIOUS VERSION HERE] ...

-- ESP System
local ESPStore = {}

local function CreateESP(player)
    if player == LocalPlayer then return end
    
    local container = Instance.new("Folder", gui)
    container.Name = player.Name
    
    -- Red/Blue Outline
    local box = Instance.new("BoxHandleAdornment")
    box.Size = Vector3.new(4, 6, 4)
    box.Transparency = 0.7
    box.ZIndex = 10
    box.AlwaysOnTop = true
    box.Visible = ESPEnabled
    box.Parent = container
    
    -- Health Bar System
    local healthBarOutline = Instance.new("Frame")
    healthBarOutline.Size = UDim2.new(0, 6, 1, -2)
    healthBarOutline.Position = UDim2.new(1, 4, 0, 1)
    healthBarOutline.BackgroundColor3 = Color3.new(0,0,0)
    healthBarOutline.BorderSizePixel = 0
    healthBarOutline.Visible = ESPEnabled
    healthBarOutline.Parent = container
    
    local healthBar = Instance.new("Frame")
    healthBar.Size = UDim2.new(0, 4, 1, -4)
    healthBar.Position = UDim2.new(0, 1, 0, 2)
    healthBar.BorderSizePixel = 0
    healthBar.BackgroundColor3 = Color3.new(0,1,0)
    healthBar.Visible = ESPEnabled
    healthBar.Parent = healthBarOutline
    
    -- Name Tag
    local nameTag = Instance.new("TextLabel")
    nameTag.Text = player.Name
    nameTag.TextColor3 = Color3.new(1,1,1)
    nameTag.BackgroundTransparency = 1
    nameTag.Size = UDim2.new(0, 200, 0, 20)
    nameTag.Visible = ESPEnabled
    nameTag.Parent = container
    
    ESPStore[player] = {
        Container = container,
        Box = box,
        HealthBar = healthBar,
        NameTag = nameTag
    }
end

local function UpdateESP()
    for player, data in pairs(ESPStore) do
        if player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
            -- Update position
            local root = player.Character.HumanoidRootPart
            local screenPos, onScreen = Camera:WorldToViewportPoint(root.Position)
            
            if onScreen then
                -- Update box
                data.Box.Adornee = root
                data.Box.Size = Vector3.new(4, 6, 4)
                
                -- Update health
                local humanoid = player.Character:FindFirstChild("Humanoid")
                if humanoid then
                    local health = humanoid.Health / humanoid.MaxHealth
                    data.HealthBar.Size = UDim2.new(1, 0, health, 0)
                    data.HealthBar.BackgroundColor3 = Color3.new(1-health, health, 0)
                end
                
                -- Update team color
                if SilentAimSettings.TeamCheck then
                    data.Box.Color = player.Team == LocalPlayer.Team 
                        and Color3.new(0, 0, 1) 
                        or Color3.new(1, 0, 0)
                else
                    data.Box.Color = Color3.new(1, 0, 0)
                end
            end
        end
    end
end

-- ESP Toggle
espToggle.MouseButton1Click:Connect(function()
    ESPEnabled = not ESPEnabled
    espToggle.Text = "ESP: " .. (ESPEnabled and "ON" or "OFF")
    
    for player, data in pairs(ESPStore) do
        data.Box.Visible = ESPEnabled
        data.HealthBar.Visible = ESPEnabled
        data.NameTag.Visible = ESPEnabled
    end
end)

-- Player Handling
game.Players.PlayerAdded:Connect(function(player)
    CreateESP(player)
end)

for _, player in ipairs(Players:GetPlayers()) do
    CreateESP(player)
end

-- ESP Update Loop
RunService.RenderStepped:Connect(function()
    if ESPEnabled then
        UpdateESP()
    end
end)

-- Silent Aim Hook
local oldNamecall
oldNamecall = hookmetamethod(game, "__namecall", function(self, ...)
    if silentAimEnabled and getnamecallmethod() == "FindPartOnRay" then
        if not (math.random(1,100) <= SilentAimSettings.HitChance) then 
            return oldNamecall(self, ...) 
        end
        
        local target = getClosestPlayer()
        if target and target.Character then
            local targetPart = target.Character:FindFirstChild(SilentAimSettings.TargetPart)
            if targetPart then
                local origin = Camera.CFrame.Position
                local direction = (targetPart.Position - origin).Unit * 1000
                return oldNamecall(self, Ray.new(origin, direction), ...)
            end
        end
    end
    return oldNamecall(self, ...)
end)
